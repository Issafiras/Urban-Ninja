<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Urban Ninja - Web App</title>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
          crossorigin=""/>

    <!-- Leaflet Routing Machine CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.css" />

    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Courier New', monospace;
            background: #000;
            color: #00FFFF;
            overflow: hidden;
        }

        #map {
            width: 100vw;
            height: 100vh;
            transition: filter 0.3s ease;
        }

        /* Ninja Mode - Dark/Hacker Theme */
        #map.ninja-mode {
            filter: invert(100%) hue-rotate(180deg) contrast(1.2) brightness(0.8);
        }

        /* Control Panel */
        .control-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #00FFFF;
            border-radius: 10px;
            padding: 15px;
            min-width: 200px;
        }

        .control-panel h2 {
            margin: 0 0 15px 0;
            color: #00FFFF;
            font-size: 18px;
            text-align: center;
            text-shadow: 0 0 10px #00FFFF;
        }

        .ninja-toggle {
            background: linear-gradient(45deg, #00FFFF, #0080FF);
            border: none;
            color: #000;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            font-family: inherit;
            width: 100%;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .ninja-toggle:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px #00FFFF;
        }

        .ninja-toggle.active {
            background: linear-gradient(45deg, #FF0080, #8000FF);
            box-shadow: 0 0 15px #FF0080;
        }

        /* Status indicator */
        .status {
            margin-top: 10px;
            text-align: center;
            font-size: 12px;
            opacity: 0.8;
        }

        /* Custom route styling */
        .leaflet-routing-container {
            background: rgba(0, 0, 0, 0.9) !important;
            border: 1px solid #00FFFF !important;
        }

        .leaflet-routing-container h2,
        .leaflet-routing-container h3 {
            color: #00FFFF !important;
        }

        .leaflet-routing-alt {
            background: rgba(0, 0, 0, 0.8) !important;
            border: 1px solid #00FFFF !important;
        }

        .leaflet-routing-alt:hover {
            background: rgba(0, 20, 20, 0.9) !important;
        }

        /* Loading animation */
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .loading {
            animation: pulse 1.5s infinite;
        }
    </style>
</head>
<body>
    <!-- Map Container -->
    <div id="map"></div>

    <!-- Control Panel -->
    <div class="control-panel">
        <h2>URBAN NINJA</h2>
        <button id="ninjaToggle" class="ninja-toggle">
            ACTIVATE NINJA MODE
        </button>
        <div class="status">Routing: Sabro → Aarhus C</div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
            crossorigin=""></script>

    <!-- Leaflet Routing Machine JS -->
    <script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.js"></script>

    <script>
        // Initialize the map
        const map = L.map('map').setView([56.208, 10.035], 13);

        // Add OpenStreetMap tiles
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '© OpenStreetMap contributors',
            maxZoom: 18,
        }).addTo(map);

        // Define waypoints: Sabro to Aarhus C
        const sabro = L.latLng(56.208, 10.035);      // Sabro, Denmark
        const aarhusC = L.latLng(56.1572, 10.2107);   // Aarhus Central Station

        // Create routing control with custom styling
        const routingControl = L.Routing.control({
            waypoints: [sabro, aarhusC],
            routeWhileDragging: true,
            createMarker: function(i, waypoint, n) {
                const markerOptions = {
                    draggable: true,
                };

                if (i === 0) {
                    // Start marker (Sabro)
                    markerOptions.icon = L.icon({
                        iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-green.png',
                        shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
                        iconSize: [25, 41],
                        iconAnchor: [12, 41],
                        popupAnchor: [1, -34],
                        shadowSize: [41, 41]
                    });
                } else if (i === n-1) {
                    // End marker (Aarhus C)
                    markerOptions.icon = L.icon({
                        iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-red.png',
                        shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
                        iconSize: [25, 41],
                        iconAnchor: [12, 41],
                        popupAnchor: [1, -34],
                        shadowSize: [41, 41]
                    });
                }

                return L.marker(waypoint.latLng, markerOptions);
            },
            lineOptions: {
                styles: [{
                    color: '#00FFFF',      // Neon Cyan
                    weight: 6,
                    opacity: 0.8
                }, {
                    color: '#0080FF',      // Slightly darker cyan for outline
                    weight: 10,
                    opacity: 0.4
                }]
            }
        }).addTo(map);

        // Ninja Mode Toggle
        const ninjaToggle = document.getElementById('ninjaToggle');
        const mapElement = document.getElementById('map');
        let isNinjaMode = false;

        ninjaToggle.addEventListener('click', function() {
            isNinjaMode = !isNinjaMode;
            mapElement.classList.toggle('ninja-mode');

            if (isNinjaMode) {
                ninjaToggle.textContent = 'DEACTIVATE NINJA MODE';
                ninjaToggle.classList.add('active');
                document.body.style.background = '#111';
                document.querySelector('.control-panel').style.borderColor = '#FF0080';
                document.querySelector('h2').style.color = '#FF0080';
                document.querySelector('h2').style.textShadow = '0 0 10px #FF0080';
            } else {
                ninjaToggle.textContent = 'ACTIVATE NINJA MODE';
                ninjaToggle.classList.remove('active');
                document.body.style.background = '#000';
                document.querySelector('.control-panel').style.borderColor = '#00FFFF';
                document.querySelector('h2').style.color = '#00FFFF';
                document.querySelector('h2').style.textShadow = '0 0 10px #00FFFF';
            }
        });

        // Add some visual feedback when routing is calculated
        routingControl.on('routesfound', function(e) {
            const routes = e.routes;
            const summary = routes[0].summary;

            document.querySelector('.status').textContent =
                `Route: ${Math.round(summary.totalDistance / 1000)}km, ${Math.round(summary.totalTime / 60)}min`;
        });

        // Handle routing errors gracefully
        routingControl.on('routingerror', function(e) {
            console.warn('Routing error:', e.error);
            document.querySelector('.status').textContent = 'Routing: Error calculating route';
        });

        // Add markers for start and end points with popups
        L.marker(sabro, {
            icon: L.icon({
                iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-green.png',
                shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
                iconSize: [25, 41],
                iconAnchor: [12, 41],
                popupAnchor: [1, -34],
                shadowSize: [41, 41]
            })
        }).addTo(map).bindPopup('<b>Sabro</b><br/>Starting Point');

        L.marker(aarhusC, {
            icon: L.icon({
                iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-red.png',
                shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
                iconSize: [25, 41],
                iconAnchor: [12, 41],
                popupAnchor: [1, -34],
                shadowSize: [41, 41]
            })
        }).addTo(map).bindPopup('<b>Aarhus C</b><br/>Destination');
    </script>
</body>
</html>
